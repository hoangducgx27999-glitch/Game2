<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T·ª´ ƒêi·ªÉn Th√†nh Ng·ªØ Trung Vi·ªát</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px 20px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .search-container {
            position: sticky;
            top: 0;
            z-index: 100;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(102, 126, 234, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .search-container.hidden {
            transform: translateY(-100%);
            opacity: 0;
        }

        .search-box {
            position: relative;
            max-width: 500px;
            margin: 0 auto;
        }

        #searchInput {
            width: 100%;
            padding: 12px 45px 12px 20px;
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-radius: 25px;
            font-size: 15px;
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
        }

        #searchInput:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }

        .search-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #667eea;
            font-size: 18px;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            padding: 10px 15px;
            overflow-x: auto;
            border-bottom: 2px solid #e9ecef;
        }

        .tab {
            padding: 10px 20px;
            margin-right: 8px;
            border: none;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: #495057;
            transition: all 0.3s ease;
            white-space: nowrap;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .tab:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .view-mode-toggle {
            padding: 10px 20px;
            text-align: center;
            background: #f8f9fa;
        }

        .view-mode-btn {
            padding: 8px 20px;
            margin: 0 5px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .view-mode-btn.active {
            background: #667eea;
            color: white;
        }

        .content {
            padding: 20px;
            max-height: calc(100vh - 250px);
            overflow-y: auto;
        }

        .idiom-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .idiom-card:hover {
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .idiom-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
            position: relative;
        }

        .idiom-title {
            flex: 1;
        }

        .idiom-chinese {
            font-size: 24px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .idiom-pinyin {
            font-size: 15px;
            color: #667eea;
            font-style: italic;
        }

        .favorite-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 5px;
            position: absolute;
            right: 0;
            top: 0;
        }

        .favorite-btn:hover {
            transform: scale(1.2);
        }

        .favorite-btn.active {
            animation: heartBeat 0.5s ease;
        }

        @keyframes heartBeat {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.3); }
            50% { transform: scale(1.1); }
        }

        .tags-container {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 12px 0;
            flex-wrap: wrap;
        }

        .tag {
            display: inline-block;
            padding: 4px 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 600;
        }

        .meaning-section {
            margin: 15px 0;
        }

        .meaning-chinese {
            font-size: 15px;
            color: #ff9800;
            font-weight: 700;
            margin-bottom: 8px;
            line-height: 1.6;
        }

        .meaning-vietnamese {
            font-size: 15px;
            color: #2c3e50;
            line-height: 1.6;
            font-weight: 500;
        }

        .examples-section {
            margin-top: 15px;
        }

        .example-toggle {
            background: #667eea;
            color: white;
            border: none;
            padding: 6px 16px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }

        .example-toggle:hover {
            background: #764ba2;
            transform: scale(1.05);
        }

        .examples-content {
            display: none;
            margin-top: 10px;
        }

        .examples-content.show {
            display: block;
            animation: slideDown 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .example-item {
            margin: 8px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 3px solid #2196f3;
        }

        .example-text {
            font-size: 15px;
            color: #2196f3;
            font-weight: 700;
            line-height: 1.6;
        }

        .synonyms-section {
            margin-top: 15px;
            padding: 12px;
            background: #fff8e1;
            border-radius: 10px;
            border-left: 4px solid #ffc107;
        }

        .synonyms-title {
            font-size: 14px;
            font-weight: 700;
            color: #f57c00;
            margin-bottom: 8px;
        }

        .synonym-item {
            display: inline-block;
            margin: 4px 8px 4px 0;
            font-size: 15px;
            color: #e65100;
            font-weight: 600;
        }

        .story-section {
            margin-top: 15px;
            padding: 15px;
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            border-radius: 10px;
            border-left: 4px solid #9c27b0;
        }

        .story-title {
            font-size: 14px;
            font-weight: 700;
            color: #9c27b0;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .story-content {
            font-size: 14px;
            color: #4a148c;
            line-height: 1.8;
        }

        .stats {
            text-align: center;
            padding: 15px;
            color: #6c757d;
            font-size: 13px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-top: 10px;
        }

        .settings-section {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            margin: 20px;
        }

        .settings-title {
            font-size: 20px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .setting-item {
            padding: 15px;
            background: white;
            border-radius: 10px;
            margin-bottom: 12px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .setting-label {
            font-size: 15px;
            font-weight: 600;
            color: #495057;
            margin-bottom: 5px;
        }

        .setting-value {
            font-size: 14px;
            color: #6c757d;
        }

        .practice-section {
            padding: 20px;
        }

        .practice-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        .practice-question {
            font-size: 20px;
            color: #2c3e50;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .practice-chinese {
            font-size: 32px;
            color: #667eea;
            font-weight: 700;
            margin: 20px 0;
        }

        .practice-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 20px 0;
        }

        .practice-option {
            padding: 15px;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            cursor: pointer;
            font-size: 15px;
            transition: all 0.3s ease;
        }

        .practice-option:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
            transform: scale(1.05);
        }

        .practice-option.correct {
            background: #4caf50;
            color: white;
            border-color: #4caf50;
        }

        .practice-option.wrong {
            background: #f44336;
            color: white;
            border-color: #f44336;
        }

        .practice-controls {
            margin-top: 20px;
        }

        .practice-btn {
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 5px;
        }

        .practice-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .practice-score {
            font-size: 18px;
            color: #667eea;
            font-weight: 700;
            margin: 15px 0;
        }

        /* Compact View Mode */
        .idiom-card.compact {
            padding: 15px;
        }

        .idiom-card.compact .idiom-chinese {
            font-size: 21px;
        }

        .idiom-card.compact .idiom-pinyin,
        .idiom-card.compact .meaning-vietnamese {
            font-size: 14px;
        }

        .idiom-card.compact .example-item {
            margin: 5px 0;
            padding: 8px;
        }

        .idiom-card.compact .tags-container,
        .idiom-card.compact .meaning-chinese {
            display: none;
        }

        .idiom-card.compact .synonyms-section {
            padding: 8px;
            margin-top: 10px;
        }

        .idiom-card.compact .example-text {
            font-size: 14px;
        }

        .idiom-card.compact .examples-content {
            display: block;
        }

        .idiom-card.compact .examples-content .example-item:not(:first-child) {
            display: none;
        }

        .idiom-card.compact .example-toggle,
        .idiom-card.compact .story-section {
            display: none;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #764ba2;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 18px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 22px;
            }

            .idiom-chinese {
                font-size: 20px;
            }

            .tabs {
                padding: 8px 10px;
            }

            .tab {
                padding: 8px 15px;
                font-size: 12px;
            }

            .practice-options {
                grid-template-columns: 1fr;
            }

            .practice-chinese {
                font-size: 26px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö T·ª´ ƒêi·ªÉn Th√†nh Ng·ªØ Trung Vi·ªát</h1>
            <p>1500+ Th√†nh Ng·ªØ & Qu√°n D·ª•ng Ng·ªØ</p>
        </div>

        <div class="search-container" id="searchContainer">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="üîç T√¨m ki·∫øm th√†nh ng·ªØ...">
                <span class="search-icon">‚åï</span>
            </div>
        </div>

        <div class="tabs" id="tabs">
            <button class="tab active" onclick="switchTab('all')">üìñ T·∫•t c·∫£</button>
            <button class="tab" onclick="switchTab('hsk6')">üéØ HSK 6</button>
            <button class="tab" onclick="switchTab('hsk79')">üèÜ HSK 7-9</button>
            <button class="tab" onclick="switchTab('gushi')">üìú C√¢u chuy·ªán</button>
            <button class="tab" onclick="switchTab('favorites')">‚ù§Ô∏è Y√™u th√≠ch</button>
            <button class="tab" onclick="switchTab('practice')">‚úèÔ∏è Luy·ªán t·∫≠p</button>
            <button class="tab" onclick="switchTab('settings')">‚öôÔ∏è C√†i ƒë·∫∑t</button>
        </div>

        <div class="view-mode-toggle" id="viewModeToggle">
            <button class="view-mode-btn active" onclick="setViewMode('full')">üìã ƒê·∫ßy ƒë·ªß</button>
            <button class="view-mode-btn" onclick="setViewMode('compact')">üìù R√∫t g·ªçn</button>
        </div>

        <div class="content" id="content">
            <div class="loading">‚è≥ ƒêang t·∫£i d·ªØ li·ªáu...</div>
        </div>
    </div>

    <script>
        let allData = [];
        let hsk6Data = [];
        let hsk79Data = [];
        let gushiData = [];
        let currentTab = 'all';
        let currentViewMode = 'full';
        let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
        let lastScrollTop = 0;
        let practiceMode = {
            questions: [],
            currentIndex: 0,
            score: 0,
            total: 0
        };

        // Load all data files
        async function loadData() {
            try {
                const [data1, data2, data3, data4] = await Promise.all([
                    fetch('thanhngu3chu.json').then(r => r.json()),
                    fetch('hsk6.json').then(r => r.json()),
                    fetch('hsk79.json').then(r => r.json()),
                    fetch('gushi.json').then(r => r.json())
                ]);

                allData = data1;
                hsk6Data = data2;
                hsk79Data = data3;
                gushiData = data4;

                displayData();
            } catch (error) {
                document.getElementById('content').innerHTML = 
                    '<div class="loading" style="color: #f44336;">‚ùå L·ªói t·∫£i d·ªØ li·ªáu. Vui l√≤ng ki·ªÉm tra file JSON.</div>';
            }
        }

        function displayData() {
            let data = [];
            const content = document.getElementById('content');

            switch(currentTab) {
                case 'all':
                    data = allData;
                    break;
                case 'hsk6':
                    data = hsk6Data;
                    break;
                case 'hsk79':
                    data = hsk79Data;
                    break;
                case 'gushi':
                    data = gushiData;
                    break;
                case 'favorites':
                    data = getFavoriteData();
                    break;
                case 'practice':
                    displayPractice();
                    return;
                case 'settings':
                    displaySettings();
                    return;
            }

            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            if (searchTerm) {
                data = data.filter(item => {
                    const chinese = (item['TH√ÄNH NG·ªÆ'] || item['Th√†nh ng·ªØ'] || '').toLowerCase();
                    const pinyin = (item['PINYIN'] || item['Pinyin'] || '').toLowerCase();
                    const meaning = (item['NGHƒ®A'] || '').toLowerCase();
                    return chinese.includes(searchTerm) || pinyin.includes(searchTerm) || meaning.includes(searchTerm);
                });
            }

            if (data.length === 0) {
                content.innerHTML = '<div class="loading">üòî Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£</div>';
                return;
            }

            let html = '';
            data.forEach((item, index) => {
                html += renderIdiomCard(item, index);
            });

            html += `<div class="stats">üìä Hi·ªÉn th·ªã ${data.length} th√†nh ng·ªØ</div>`;
            content.innerHTML = html;
        }

        function renderIdiomCard(item, index) {
            const chinese = item['TH√ÄNH NG·ªÆ'] || item['Th√†nh ng·ªØ'] || '';
            const pinyin = item['PINYIN'] || item['Pinyin'] || '';
            const meaning = item['NGHƒ®A'] || '';
            const meaningChinese = item['Èáä‰πâ'] || '';
            const story = item['c√¢u chuy·ªán th√†nh ng·ªØ'] || '';
            const isFavorite = favorites.includes(chinese);
            
            const compactClass = currentViewMode === 'compact' ? 'compact' : '';
            
            // Check if has story in gushiData
            const hasStory = gushiData.some(g => (g['TH√ÄNH NG·ªÆ'] || g['Th√†nh ng·ªØ']) === chinese);
            
            // Get tags
            let tags = '';
            if (currentTab === 'hsk6' || hsk6Data.some(h => (h['Th√†nh ng·ªØ']) === chinese)) {
                tags += '<span class="tag">HSK 6</span>';
            }
            if (currentTab === 'hsk79' || hsk79Data.some(h => (h['Th√†nh ng·ªØ']) === chinese)) {
                tags += '<span class="tag">HSK 7-9</span>';
            }

            // Examples
            let examples = '';
            const ex1 = item['V√≠ d·ª• 1'] || '';
            const ex2 = item['V√≠ d·ª• 2'] || '';
            if (ex1) examples += `<div class="example-item"><div class="example-text">${ex1}</div></div>`;
            if (ex2) examples += `<div class="example-item"><div class="example-text">${ex2}</div></div>`;

            // Synonyms
            let synonyms = '';
            const syn1 = item['ƒê·ªìng nghƒ©a 1'] || item['G·∫¶N NGHƒ®A 1'] || item['ƒê·ªìng nghƒ©a 2'] || '';
            const syn2 = item['ƒê·ªìng nghƒ©a 2'] || item['G·∫¶N NGHƒ®A 2'] || '';
            if (syn1 || syn2) {
                synonyms = `
                    <div class="synonyms-section">
                        <div class="synonyms-title">üí´ T·ª´ ƒë·ªìng nghƒ©a</div>
                        ${syn1 ? `<span class="synonym-item">${syn1}</span>` : ''}
                        ${syn2 ? `<span class="synonym-item">${syn2}</span>` : ''}
                    </div>
                `;
            }

            // Story section
            let storyHtml = '';
            if (hasStory && story) {
                storyHtml = `
                    <div class="story-section">
                        <div class="story-title">üìñ C√¢u chuy·ªán th√†nh ng·ªØ</div>
                        <div class="story-content">${story}</div>
                    </div>
                `;
            }

            return `
                <div class="idiom-card ${compactClass}" data-index="${index}">
                    <div class="idiom-header">
                        <div class="idiom-title">
                            <div class="idiom-chinese">${chinese}</div>
                            <div class="idiom-pinyin">${pinyin}</div>
                        </div>
                        <button class="favorite-btn ${isFavorite ? 'active' : ''}" onclick="toggleFavorite('${chinese}', event)">
                            ${isFavorite ? '‚ù§Ô∏è' : 'ü§ç'}
                        </button>
                    </div>
                    
                    ${tags ? `<div class="tags-container">${tags}</div>` : ''}
                    
                    <div class="meaning-section">
                        ${meaningChinese ? `<div class="meaning-chinese">${meaningChinese}</div>` : ''}
                        <div class="meaning-vietnamese">üáªüá≥ ${meaning}</div>
                    </div>
                    
                    ${synonyms}
                    
                    ${examples && currentViewMode !== 'compact' ? `
                        <div class="examples-section">
                            <button class="example-toggle" onclick="toggleExamples(${index})">
                                üìù Xem v√≠ d·ª•
                            </button>
                            <div class="examples-content" id="examples-${index}">
                                ${examples}
                            </div>
                        </div>
                    ` : ''}
                    
                    ${currentViewMode === 'compact' && ex1 ? `
                        <div class="examples-content show">
                            <div class="example-item"><div class="example-text">${ex1}</div></div>
                        </div>
                    ` : ''}
                    
                    ${storyHtml}
                </div>
            `;
        }

        function toggleExamples(index) {
            const element = document.getElementById(`examples-${index}`);
            element.classList.toggle('show');
        }

        function toggleFavorite(chinese, event) {
            event.stopPropagation();
            const index = favorites.indexOf(chinese);
            if (index > -1) {
                favorites.splice(index, 1);
            } else {
                favorites.push(chinese);
            }
            localStorage.setItem('favorites', JSON.stringify(favorites));
            displayData();
        }

        function getFavoriteData() {
            const allCombined = [...allData, ...hsk6Data, ...hsk79Data, ...gushiData];
            const unique = [];
            const seen = new Set();
            
            allCombined.forEach(item => {
                const chinese = item['TH√ÄNH NG·ªÆ'] || item['Th√†nh ng·ªØ'] || '';
                if (favorites.includes(chinese) && !seen.has(chinese)) {
                    seen.add(chinese);
                    unique.push(item);
                }
            });
            
            return unique;
        }

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            // Hide view mode toggle for practice and settings
            const viewModeToggle = document.getElementById('viewModeToggle');
            if (tab === 'practice' || tab === 'settings') {
                viewModeToggle.style.display = 'none';
            } else {
                viewModeToggle.style.display = 'block';
            }
            
            displayData();
        }

        function setViewMode(mode) {
            currentViewMode = mode;
            document.querySelectorAll('.view-mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            displayData();
        }

        function displaySettings() {
            document.getElementById('content').innerHTML = `
                <div class="settings-section">
                    <div class="settings-title">‚öôÔ∏è C√†i ƒë·∫∑t</div>
                    
                    <div class="setting-item">
                        <div class="setting-label">üìö Ngu·ªìn d·ªØ li·ªáu</div>
                        <div class="setting-value">T·ª´ ƒêi·ªÉn Th√†nh Ng·ªØ & Qu√°n D·ª•ng Ng·ªØ Trung Vi·ªát</div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-label">üìä T·ªïng s·ªë th√†nh ng·ªØ</div>
                        <div class="setting-value">
                            ‚Ä¢ Th√†nh ng·ªØ 3 ch·ªØ: ${allData.length} m·ª•c<br>
                            ‚Ä¢ HSK 6: ${hsk6Data.length} m·ª•c<br>
                            ‚Ä¢ HSK 7-9: ${hsk79Data.length} m·ª•c<br>
                            ‚Ä¢ C√¢u chuy·ªán: ${gushiData.length} m·ª•c<br>
                            ‚Ä¢ Y√™u th√≠ch: ${favorites.length} m·ª•c
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-label">üë®‚Äçüíª Nh√† ph√°t tri·ªÉn</div>
                        <div class="setting-value">Ho√†ng Minh ƒê·ª©c</div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-label">‚ÑπÔ∏è Phi√™n b·∫£n</div>
                        <div class="setting-value">v2.0 - N√¢ng c·∫•p giao di·ªán & t√≠nh nƒÉng</div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-label">‚ú® T√≠nh nƒÉng m·ªõi</div>
                        <div class="setting-value">
                            ‚Ä¢ üéØ Luy·ªán t·∫≠p th√†nh ng·ªØ<br>
                            ‚Ä¢ üìù Ch·∫ø ƒë·ªô xem r√∫t g·ªçn<br>
                            ‚Ä¢ ‚ù§Ô∏è ƒê√°nh d·∫•u y√™u th√≠ch<br>
                            ‚Ä¢ üîç T√¨m ki·∫øm th√¥ng minh<br>
                            ‚Ä¢ üìñ C√¢u chuy·ªán th√†nh ng·ªØ<br>
                            ‚Ä¢ üé® Giao di·ªán hi·ªán ƒë·∫°i
                        </div>
                    </div>
                </div>
            `;
        }

        function displayPractice() {
            if (practiceMode.questions.length === 0) {
                startNewPractice();
            } else {
                showPracticeQuestion();
            }
        }

        function startNewPractice() {
            // Get random 10 idioms
            const allCombined = [...allData, ...hsk6Data, ...hsk79Data];
            const shuffled = allCombined.sort(() => 0.5 - Math.random());
            practiceMode.questions = shuffled.slice(0, 10);
            practiceMode.currentIndex = 0;
            practiceMode.score = 0;
            practiceMode.total = 0;
            showPracticeQuestion();
        }

        function showPracticeQuestion() {
            if (practiceMode.currentIndex >= practiceMode.questions.length) {
                showPracticeResult();
                return;
            }

            const question = practiceMode.questions[practiceMode.currentIndex];
            const chinese = question['TH√ÄNH NG·ªÆ'] || question['Th√†nh ng·ªØ'] || '';
            const correctAnswer = question['NGHƒ®A'] || '';
            
            // Get 3 random wrong answers
            const allCombined = [...allData, ...hsk6Data, ...hsk79Data];
            const wrongAnswers = allCombined
                .filter(item => (item['NGHƒ®A'] || '') !== correctAnswer)
                .sort(() => 0.5 - Math.random())
                .slice(0, 3)
                .map(item => item['NGHƒ®A'] || '');
            
            const options = [correctAnswer, ...wrongAnswers].sort(() => 0.5 - Math.random());

            document.getElementById('content').innerHTML = `
                <div class="practice-section">
                    <div class="practice-card">
                        <div class="practice-question">‚ùì Th√†nh ng·ªØ n√†y nghƒ©a l√† g√¨?</div>
                        <div class="practice-chinese">${chinese}</div>
                        <div class="practice-score">
                            üìä C√¢u ${practiceMode.currentIndex + 1}/10 | 
                            üéØ ƒêi·ªÉm: ${practiceMode.score}/${practiceMode.total}
                        </div>
                        <div class="practice-options">
                            ${options.map((opt, i) => `
                                <div class="practice-option" onclick="checkAnswer('${opt.replace(/'/g, "\\'")}', '${correctAnswer.replace(/'/g, "\\'")}', this)">
                                    ${opt}
                                </div>
                            `).join('')}
                        </div>
                        <div class="practice-controls">
                            <button class="practice-btn" onclick="skipQuestion()">‚è≠Ô∏è B·ªè qua</button>
                            <button class="practice-btn" onclick="startNewPractice()">üîÑ L√†m l·∫°i</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function checkAnswer(selected, correct, element) {
            practiceMode.total++;
            
            if (selected === correct) {
                element.classList.add('correct');
                practiceMode.score++;
                setTimeout(() => {
                    practiceMode.currentIndex++;
                    showPracticeQuestion();
                }, 1000);
            } else {
                element.classList.add('wrong');
                // Highlight correct answer
                document.querySelectorAll('.practice-option').forEach(opt => {
                    if (opt.textContent.trim() === correct) {
                        opt.classList.add('correct');
                    }
                });
                setTimeout(() => {
                    practiceMode.currentIndex++;
                    showPracticeQuestion();
                }, 2000);
            }
            
            // Disable all options
            document.querySelectorAll('.practice-option').forEach(opt => {
                opt.style.pointerEvents = 'none';
            });
        }

        function skipQuestion() {
            practiceMode.total++;
            practiceMode.currentIndex++;
            showPracticeQuestion();
        }

        function showPracticeResult() {
            const percentage = Math.round((practiceMode.score / practiceMode.total) * 100);
            let emoji = 'üéâ';
            let message = 'Xu·∫•t s·∫Øc!';
            
            if (percentage < 50) {
                emoji = 'üí™';
                message = 'C·ªë g·∫Øng l√™n!';
            } else if (percentage < 80) {
                emoji = 'üëç';
                message = 'T·ªët l·∫Øm!';
            }

            document.getElementById('content').innerHTML = `
                <div class="practice-section">
                    <div class="practice-card">
                        <div style="font-size: 64px; margin: 20px 0;">${emoji}</div>
                        <div class="practice-question">${message}</div>
                        <div class="practice-score" style="font-size: 24px; margin: 20px 0;">
                            K·∫øt qu·∫£: ${practiceMode.score}/${practiceMode.total} 
                            (${percentage}%)
                        </div>
                        <div class="practice-controls">
                            <button class="practice-btn" onclick="startNewPractice()">üîÑ L√†m l·∫°i</button>
                            <button class="practice-btn" onclick="switchTab('all'); displayData();">üìö V·ªÅ trang ch·ªß</button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Search functionality
        document.getElementById('searchInput').addEventListener('input', function() {
            displayData();
        });

        // Auto-hide search bar on scroll
        const content = document.getElementById('content');
        const searchContainer = document.getElementById('searchContainer');
        
        content.addEventListener('scroll', function() {
            const scrollTop = content.scrollTop;
            
            if (scrollTop > lastScrollTop && scrollTop > 100) {
                searchContainer.classList.add('hidden');
            } else {
                searchContainer.classList.remove('hidden');
            }
            
            lastScrollTop = scrollTop;
        });

        // Load data on page load
        loadData();
    </script>
</body>
</html>
